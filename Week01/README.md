1. #### 关于微服务的基础知识

   1. ##### 概念

      微服务是一种用于构建应用的架构方案。微服务架构有别于更为传统的单体式方案，可将应用拆分成多个核心功能。每个功能都称为一项服务，可以单独构建和部署，这意味着各项服务在工作和出现故障时不会相互影响。

   2. ##### 架构要素

      微服务具有**服务组件化、去中心化、基础设施自动化**等特点，基于这些特点可以提炼出构建微服务架构的三大要素：**服务建模、技术体系、研发过程**

      1. ###### 服务建模

         针对服务建模，需要先明确服务的类别，以及服务与业务之间的关系，尽可能的明确领域的边界。可以使用领域驱动设计(Domain Driven Design，DDD)方法，通过识别领域中的各个子域、判断这些子域是否独立、考虑子域与子域的交互关系，从而明确各个界限上下文(Boundary Context)之间的边界。

         系统中的各个子域可以分为**核心子域**、**支撑子域**和**通用子域**。其中系统中核心业务称为核心子域，专注于某一方面的子域称为支撑子域，可以作为某种基础设施的子域可以归到通用子域。

         服务建模的本质是为了满足业务需求，服务围绕业务能力建模，而业务能力往往体现出分层结构，可以将业务体系中的服务分为以下几种类型：**基础服务**、**通用服务**、**定制服务**和**其它服务**

      2. ###### 技术体系

         微服务架构相关技术体系比较复杂，但可以归纳分为以下八大技术体系：**服务通信、服务治理、服务路由、服务容错、服务网关、服务配置、服务安全、服务监控**

         1. 服务通信

            网络通信是任何分布式系统的基础组件。在微服务架构中我们关注的是**网络连接模式、I/O模型、服务调用方式**

            网络连接：长连接和短链接

            I/O模型：阻塞式和非阻塞式

            服务调用方式：异步和同步

         2. 服务治理

            最为关键的一个技术组件，一般称为**注册中心**。是保存服务调用所需的路由信息的存储仓库，也是服务提供者和服务消费者进行交互的媒介，充当着服务注册和发现服务器的作用。一般是通过Zookeeper、Etcd、Eureka等分布式系统协调工具构建

         3. 服务路由

            负载均衡是最常见的一种服务路由方案

         4. 服务容错

            对于分布式环境中的服务而言，服务在自身失败引发错误的同时，还会因为依赖其它服务而导致失败，所以需要考虑各种场景的服务容错机制。

            集群容错策略：失效转移Failover 

            服务隔离机制：线程隔离、进程隔离

            服务限流机制：滑动窗口、令牌桶算法

            服务熔断机制：

         5. 服务网关

            也叫网关API，封装了系统内部架构，为每一个客户端提供一个定制的API。所有客户端和消费端都通过统一的网关接入微服务，在网关层处理所有的非业务功能。

            在功能设计上，服务网关在完成客户端与服务器端报文格式转换的同时，它可能还具有身份验证、监控、缓存、请求管理、静态响应处理等功能。另一方面，也可以在网关层制定灵活的路由策略。针对一些特定的 API，我们需要设置白名单、路由规则等各类限制

         6. 服务配置

            与注册中心一样，配置中心也是微服务架构中的基础组件，其目的也是对服务进行统一管理，区别在于配置中心管理的对象是配置信息而不是服务的实例信息。

            配置中心通常需要依赖分布式协调机制，通过一定的方法确保配置信息在分布式环境中的各个服务中能得到实时、一致的管理。可以采用诸如 Zookeeper 等主流的开源分布式协调框架来构建配置中心

         7. 服务安全

            一般意义上的访问安全性，都是围绕认证和授权这两个核心概念来展开的。首先确定用户身份，然后确定这个用户是否具有访问指定资源的权限。站在多个服务交互的角度讲，我们需要确保 Token 在各个微服务之间的有效传播。另一方面，服务内部，我们可以使用不同的访问策略限制服务资源的访问。

         8. 服务监控

            当服务数量达到一定量级时，我们难免会遇到两个核心问题。一个是如何管理服务之间的调用关系，另一个是如何跟踪业务流的处理过程和结果，这就需要构建分布式服务跟踪机制。

            分布式服务跟踪机制的建立需要完成调用链数据的生成、采集、存储及查询，同时也需要对这些调用链数据进行运算和可视化管理

      3. ###### 研发过程

         微服务需要围绕“业务功能”组织团队的研发管理。

         任何一个需求，无论大小，都将导致跨团队协作，从而增加沟通和协作成本。而微服务架构则倾向围绕业务功能的组织来分割服务，而不是面向某项技术能力。因此，团队是跨职能的特征团队，每个服务都围绕着业务进行构建，并且能够被独立部署到生产环境

   3. 

2. #### 关于本周课程的学习笔记

   1. 微服务概览 & 微服务设计
      1. 可以把微服务看作使SOA的一种实践。围绕业务功能构建的，服务关注单一业务，服务间采用轻量级的通信机制，可以全自动独立部署，可以使用不同的编程语言和数据存储技术。微服务架 构通过业务拆分实现服务组件化，通过组件组合快速开发系统，业务单一的服务组件又可以独立部署， 使得整个系统变得清晰灵活
   2. gRPC & 服务发现
   3. 多集群 & 多租户
   
3. #### 一些补充知识

   1. 康威定律

      康威定律是马尔文·康威1967提出的：“设计系统的架构受制于产生这些设计的组织的沟通结构。”通俗的来讲：产品必然是其（人员）组织沟通结构的缩影。

      - 第一定律 组织沟通方式会通过系统设计表达出来。

      - 第二定律 时间再多一件事情也不可能做的完美，但总有时间做完一件事情。
      - 第三定律 线型系统和线型组织架构间有潜在的异质同态特性。
      - 第四定律 大的系统组织总是比小系统更倾向于分解。

   2. Envoy

      Envoy 是专为大型现代 SOA（面向服务架构）架构设计的 L7 代理和通信总线。

      该项目源于以下理念：网络对应用程序来说应该是透明的。当网络和应用程序出现问题时，应该很容易确定问题的根源

   3. BFF，Backend for Frontend

      服务于前端的后端。也就是服务器设计 API 时会考虑前端的使用，并在服务端直接进行业务逻辑的处理，又称为用户体验适配器。BFF 只是一种逻辑分层，而非一种技术。

      BFF与用户体验一对一，也就是要把一个大后端拆成多个小后端。负责根据不同UI端的展示需求对数据进行组装，为了减少拆分后相同功能代码的冗余，可以在BFF之上在抽离出一层网关服务，用于处理一些通用的后端逻辑，如授权、认证、限流等

   4. SSR ， Server-Side Rendering

      服务器端渲染。直接把一个 SPA(单页面) 应用输出成 HTML 字符串

   5. DDD，Domain Driven Design

      领域驱动设计。

   6. CQRS，Command Query Responsibility Segregation

      命令查询职责分离。将 command 与 query 分离的一种模式。CQRS 将系统中的操作分为两类，即命令(Command) 与查询(Query)。命令即新增，更新，删除这些会引起数据发生变化操作的总称，而查询则是不会对数据产生变化的操作，只是按照某些条件查找数据。

      CQRS 的核心思想是将这两类不同的操作进行分离，然后在两个独立的服务中实现。可以是两个独立部署的应用。也可以部署在同一个应用内的不同接口上。

      Command 与 Query 对应的数据源也应该是互相独立的，即更新操作在一个数据源，而查询操作在另一个数据源上。当 command 系统完成数据更新的操作后，会通过领域事件的方式通知 query 系统。query 系统在接受到事件之后更新自己的数据源。所有的查询操作都通过 query 系统暴露的接口完成。

   7. Sevice Mesh

      服务网格是一个基础设施层，用于处理服务间通信。相当于微服务时代的TCP协议。

      云原生应用有着复杂的服务拓扑，服务网格保证请求在这些拓扑中可靠地穿梭。在实际应用当中，服务网格通常是由一系列轻量级的网络代理组成的，它们与应用程序部署在一起，但对应用程序透明。

      - 屏蔽分布式系统通信的复杂性(负载均衡、服务发现、认证授权、监控追踪、流量控制等等)，服务只用关注业务逻辑；
      - 真正的语言无关，服务可以用任何语言编写，只需和Service Mesh通信即可；
      - 对应用透明，Service Mesh组件可以单独升级；

   8. JWT，JSON Web Token

      是一种跨域认证解决方案。它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。

      JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户。以后，用户与服务端通信的时候，都要发回这个 JSON 对象，服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候会加上签名。由于服务端不保存JSON对象，所以对于服务端来说JWT是无状态的。

   9. Git、GitLab和GitHub

      Git是版本控制系统。诞生于2005年，Linus开发的作品。

      Github诞生于2008年，全球最大的代码开源社区，注册免费用户即可在Github上免费托管开源代码，如需建立私有仓库必须付费。

      GitLab和GitHub一样属于第三方基于Git开发的作品，免费且开源。与Github类似，可以注册用户，任意提交自己的代码，添加SSHKey等等。不同的是，GitLab是可以部署到自己的服务器上，数据库等一切信息都掌握在自己手上，适合团队内部协作开发，简单来说可把GitLab看作个人版的GitHub。

   10. Protocol Buffer

       是一种支持多平台、多语言、可扩展的的数据序列化机制，相较于XML来说，protobuf更小更快更简单，支持自定义的数据结构，用protobuf编译器生成特定语言的源代码，如C++、Java、Python，Go等。目前protoBuf对主流的编程语言都提供了支持,非常方便的进行序列化和反序列化。